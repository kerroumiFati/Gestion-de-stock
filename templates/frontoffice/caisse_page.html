<!DOCTYPE html>
{% load i18n %}
{% load static %}
{% get_current_language as LANGUAGE_CODE %}
<html lang="{{ LANGUAGE_CODE|default:'fr' }}" dir="{% if LANGUAGE_CODE == 'ar' %}rtl{% else %}ltr{% endif %}">
<head>
    <meta charset="UTF-8">
    <title>{% trans "Caisse" %} - {% trans "Market" %}</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap4-theme@1.5.2/dist/select2-bootstrap4.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'style/select2-custom.css' %}">

    <link rel="stylesheet" href="{% static 'style/style.css' %}">
    <link rel="stylesheet" href="{% static 'style/theme.css' %}">
    <link rel="stylesheet" href="{% static 'style/sidebar-improvements.css' %}">
    <link rel="stylesheet" href="{% static 'style/main.css' %}">
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="{% static 'style/responsive.css' %}">
    <!-- RTL CSS for Arabic -->
    {% if LANGUAGE_CODE == 'ar' %}
    <link rel="stylesheet" href="{% static 'style/rtl.css' %}">
    {% endif %}

    <style>
        /* Sidebar Dropdown Styles */
        .sidebar-dropdown > a.dropdown-toggle {
            display: flex !important;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        .sidebar-dropdown > a.dropdown-toggle i.arrow {
            margin-left: auto;
            font-size: 10px;
            transition: transform .25s ease;
        }

        .sidebar-dropdown.active > a.dropdown-toggle i.arrow {
            transform: rotate(-180deg);
        }

        .sidebar-submenu {
            list-style: none;
            margin: 0;
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height .3s ease;
            background: rgba(0,0,0,.15);
            border-radius: 8px;
            margin-top: 4px;
        }

        .sidebar-dropdown.active .sidebar-submenu {
            max-height: 500px !important;
            padding: 6px 0 !important;
        }

        .sidebar-submenu li {
            margin: 0;
        }

        .sidebar-submenu li a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px 8px 40px;
            color: #9ca3af;
            text-decoration: none;
            font-size: 13px;
            transition: all .2s ease;
            border-radius: 6px;
            margin: 0 6px;
        }

        .sidebar-submenu li a:hover {
            background: rgba(59,130,246,.15);
            color: #e5e7eb;
            padding-left: 44px;
        }

        .sidebar-submenu li a.active {
            background: rgba(59,130,246,.25);
            color: #fff;
        }

        .sidebar-submenu li a i {
            width: 16px;
            text-align: center;
            font-size: 12px;
        }

        .sidebar-submenu li a:hover i {
            color: #3b82f6;
        }
    </style>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <link rel="icon" href="{% static 'img/no-photo.png' %}" type="image/png">
</head>
<body>
<div class="page-wrapper chiller-theme toggled">
    <a id="show-sidebar" class="btn btn-sm btn-dark" href="#">
        <i class="fas fa-bars"></i>
    </a>
    <nav id="sidebar" class="sidebar-wrapper">
        <div class="sidebar-content">
            <div class="sidebar-brand">
                <a href="/admindash/" class="h2 pt-2">{% trans "Market" %}</a>
                <div id="close-sidebar">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            <div class="sidebar-header">
                <div class="user-pic">
                    <img class="img-responsive img-rounded" src="{% static 'img/no-photo.png' %}" alt="User picture">
                </div>
                <div class="user-info">
                    <span class="user-name"><strong>{{ user.username }}</strong></span>
                    <span class="user-role">{{ user.groups.first.name|default:"Utilisateur" }}</span>
                </div>
            </div>

            <div class="sidebar-menu">
                <ul>
                    <li class="sidebar-dropdown">
                        <a href="#" class="dropdown-toggle sidebar-item">
                            <i class="fas fa-handshake"></i><span>{% trans "Commercial" %}</span>
                            <i class="fas fa-chevron-down arrow"></i>
                        </a>
                        <ul class="sidebar-submenu">
                            <li><a href="/admindash/#achat">
                                <i class="fas fa-shopping-bag"></i>{% trans "Achats" %}
                            </a></li>
                            <li><a href="/admindash/#vente">
                                <i class="fas fa-shopping-cart"></i>{% trans "Ventes" %}
                            </a></li>
                            <li><a href="/caisse/" class="active">
                                <i class="fas fa-cash-register"></i>{% trans "Caisse" %}
                            </a></li>
                            <li><a href="/admindash/#facture">
                                <i class="fas fa-file-invoice"></i>{% trans "Factures" %}
                            </a></li>
                        </ul>
                    </li>

                    <li class="sidebar-dropdown">
                        <a href="#" class="dropdown-toggle sidebar-item">
                            <i class="fas fa-database"></i><span>{% trans "Gestion des données" %}</span>
                            <i class="fas fa-chevron-down arrow"></i>
                        </a>
                        <ul class="sidebar-submenu">
                            <li><a href="/admindash/#produit">
                                <i class="fas fa-box"></i>{% trans "Produits" %}
                            </a></li>
                            <li><a href="/admindash/#client">
                                <i class="fas fa-users"></i>{% trans "Clients" %}
                            </a></li>
                            <li><a href="/admindash/#fournisseur">
                                <i class="fas fa-truck"></i>{% trans "Fournisseurs" %}
                            </a></li>
                            <li><a href="/admindash/#categorie">
                                <i class="fas fa-tags"></i>{% trans "Catégories" %}
                            </a></li>
                            <li><a href="/admindash/#entrepots">
                                <i class="fas fa-warehouse"></i>{% trans "Entrepôts" %}
                            </a></li>
                        </ul>
                    </li>

                    <li class="sidebar-dropdown">
                        <a href="#" class="dropdown-toggle sidebar-item">
                            <i class="fas fa-boxes"></i><span>{% trans "Gestion de stock" %}</span>
                            <i class="fas fa-chevron-down arrow"></i>
                        </a>
                        <ul class="sidebar-submenu">
                            <li><a href="/admindash/#inventaire">
                                <i class="fas fa-clipboard-check"></i>{% trans "Inventaire" %}
                            </a></li>
                            <li><a href="/admindash/#mouvements">
                                <i class="fas fa-exchange-alt"></i>{% trans "Mouvements" %}
                            </a></li>
                        </ul>
                    </li>

                    <li class="sidebar-dropdown">
                        <a href="#" class="dropdown-toggle sidebar-item">
                            <i class="fas fa-chart-line"></i><span>{% trans "Rapports & Analyses" %}</span>
                            <i class="fas fa-chevron-down arrow"></i>
                        </a>
                        <ul class="sidebar-submenu">
                            <li><a href="/admindash/#statistiques">
                                <i class="fas fa-chart-bar"></i>{% trans "Statistiques" %}
                            </a></li>
                            <li><a href="/admindash/#rapports">
                                <i class="fas fa-file-export"></i>{% trans "Rapports" %}
                            </a></li>
                            {% if user.is_staff %}
                            <li><a href="/audit-logs/">
                                <i class="fas fa-clipboard-list"></i>{% trans "Journaux d'audit" %}
                            </a></li>
                            {% endif %}
                        </ul>
                    </li>

                    <li><a href="/admindash/#import" class="sidebar-item">
                        <i class="fas fa-file-import"></i><span>{% trans "Import de données" %}</span>
                    </a></li>

                    <li><a href="/admindash/#parametres" class="sidebar-item">
                        <i class="fas fa-cogs"></i><span>{% trans "Paramètres" %}</span>
                    </a></li>

                    {% if user.is_staff %}
                    <li class="header-menu"><span>{% trans "ADMINISTRATION" %}</span></li>
                    <li><a href="/admindash/#admin" class="sidebar-item">
                        <i class="fas fa-tools"></i><span>{% trans "Tableau de bord Admin" %}</span>
                    </a></li>
                    <li><a href="/users-admin/" class="sidebar-item">
                        <i class="fas fa-user-shield"></i><span>{% trans "Utilisateurs" %}</span>
                    </a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
        <div class="sidebar-footer">
            <a href="/logout/" class="logout-link">
                <i class="fa fa-power-off"></i>
                <span>{% trans "Déconnexion" %}</span>
            </a>
        </div>
    </nav>

    <main class="page-content">
        {% include 'frontoffice/page/caisse.html' %}
    </main>
</div>

<script src="{% static 'js/main.js' %}"></script>
<script src="{% static 'js/sidebar-enhancements.js' %}"></script>

<script>
// Sidebar Dropdown Management for Caisse page
jQuery(document).ready(function($) {
    console.log('[Caisse Sidebar Dropdown] Initializing...');

    // Handle dropdown toggle clicks
    $('.sidebar-dropdown > .dropdown-toggle').on('click', function(e) {
        e.preventDefault();
        e.stopPropagation();

        console.log('[Caisse Sidebar Dropdown] Dropdown clicked');

        var $parent = $(this).parent('.sidebar-dropdown');
        var isActive = $parent.hasClass('active');

        // Close all other dropdowns (accordion behavior)
        $('.sidebar-dropdown.active').removeClass('active');

        // Toggle current dropdown
        if (!isActive) {
            $parent.addClass('active');
            console.log('[Caisse Sidebar Dropdown] Opened dropdown');
        } else {
            console.log('[Caisse Sidebar Dropdown] Closed dropdown');
        }

        return false;
    });

    // Prevent submenu links from closing the dropdown
    $('.sidebar-submenu a').on('click', function(e) {
        e.stopPropagation();
    });

    // Auto-open the Commercial dropdown since we're on Caisse page
    setTimeout(function() {
        $('.sidebar-dropdown:first').addClass('active');
        console.log('[Caisse Sidebar Dropdown] Auto-opened Commercial dropdown');
    }, 100);

    console.log('[Caisse Sidebar Dropdown] Found ' + $('.sidebar-dropdown').length + ' dropdowns');
    console.log('[Caisse Sidebar Dropdown] Initialization complete');
});
</script>
</body>
</html>
