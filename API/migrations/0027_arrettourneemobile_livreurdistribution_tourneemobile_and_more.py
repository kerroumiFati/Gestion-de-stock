# Generated by Django 4.2.25 on 2025-11-12 10:12

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('API', '0026_add_distribution_module'),
    ]

    operations = [
        migrations.CreateModel(
            name='ArretTourneeMobile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ordre_passage', models.PositiveIntegerField(default=1, verbose_name='Ordre de passage')),
                ('statut', models.CharField(choices=[('en_attente', 'En attente'), ('livre', 'Livré'), ('echec', 'Échec'), ('reporte', 'Reporté')], default='en_attente', max_length=20, verbose_name='Statut')),
                ('heure_prevue', models.TimeField(blank=True, null=True, verbose_name='Heure prévue')),
                ('heure_arrivee', models.DateTimeField(blank=True, null=True, verbose_name="Heure d'arrivée")),
                ('heure_depart', models.DateTimeField(blank=True, null=True, verbose_name='Heure de départ')),
                ('latitude', models.DecimalField(blank=True, decimal_places=7, max_digits=10, null=True, verbose_name='Latitude')),
                ('longitude', models.DecimalField(blank=True, decimal_places=7, max_digits=10, null=True, verbose_name='Longitude')),
                ('signature_base64', models.TextField(blank=True, verbose_name='Signature (base64)')),
                ('photo_livraison', models.ImageField(blank=True, null=True, upload_to='livraisons/', verbose_name='Photo de livraison')),
                ('nom_receptionnaire', models.CharField(blank=True, max_length=200, verbose_name='Nom du réceptionnaire')),
                ('motif_echec', models.CharField(blank=True, max_length=200, verbose_name="Motif d'échec")),
                ('notes_echec', models.TextField(blank=True, verbose_name='Notes échec')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('client', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='arrets', to='API.client')),
            ],
            options={
                'verbose_name': 'Arrêt tournée',
                'verbose_name_plural': 'Arrêts tournées',
                'ordering': ['tournee', 'ordre_passage'],
            },
        ),
        migrations.CreateModel(
            name='LivreurDistribution',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('matricule', models.CharField(max_length=20, unique=True, verbose_name='Matricule')),
                ('nom', models.CharField(max_length=200, verbose_name='Nom complet')),
                ('telephone', models.CharField(max_length=20, verbose_name='Téléphone')),
                ('email', models.EmailField(blank=True, max_length=254, verbose_name='Email')),
                ('vehicule_immatriculation', models.CharField(blank=True, max_length=20, verbose_name='Immatriculation')),
                ('vehicule_marque', models.CharField(blank=True, max_length=100, verbose_name='Marque du véhicule')),
                ('statut', models.CharField(choices=[('actif', 'Actif'), ('inactif', 'Inactif'), ('conge', 'En congé'), ('suspendu', 'Suspendu')], default='actif', max_length=20, verbose_name='Statut')),
                ('date_embauche', models.DateField(blank=True, null=True, verbose_name="Date d'embauche")),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('entrepot', models.ForeignKey(help_text='Entrepôt mobile associé au van', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='livreur_associe', to='API.warehouse')),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='livreur_distribution_profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Livreur Distribution',
                'verbose_name_plural': 'Livreurs Distribution',
                'db_table': 'api_livreur_distribution',
                'ordering': ['nom'],
            },
        ),
        migrations.CreateModel(
            name='TourneeMobile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date_tournee', models.DateField(verbose_name='Date de la tournée')),
                ('numero_tournee', models.CharField(max_length=50, unique=True, verbose_name='N° Tournée')),
                ('statut', models.CharField(choices=[('planifiee', 'Planifiée'), ('en_cours', 'En cours'), ('terminee', 'Terminée'), ('annulee', 'Annulée'), ('cloturee', 'Clôturée et verrouillée')], default='planifiee', max_length=20, verbose_name='Statut')),
                ('heure_debut', models.TimeField(blank=True, null=True, verbose_name='Heure de début')),
                ('heure_fin', models.TimeField(blank=True, null=True, verbose_name='Heure de fin')),
                ('position_depart_lat', models.DecimalField(blank=True, decimal_places=7, max_digits=10, null=True, verbose_name='Latitude départ')),
                ('position_depart_lng', models.DecimalField(blank=True, decimal_places=7, max_digits=10, null=True, verbose_name='Longitude départ')),
                ('position_fin_lat', models.DecimalField(blank=True, decimal_places=7, max_digits=10, null=True, verbose_name='Latitude fin')),
                ('position_fin_lng', models.DecimalField(blank=True, decimal_places=7, max_digits=10, null=True, verbose_name='Longitude fin')),
                ('distance_km', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True, verbose_name='Distance (km)')),
                ('est_cloturee', models.BooleanField(default=False, verbose_name='Clôturée')),
                ('date_cloture', models.DateTimeField(blank=True, null=True, verbose_name='Date de clôture')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('cloturee_par', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tournees_cloturees', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tournees_creees', to=settings.AUTH_USER_MODEL)),
                ('livreur', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tournees', to='API.livreurdistribution')),
            ],
            options={
                'verbose_name': 'Tournée',
                'verbose_name_plural': 'Tournées',
                'ordering': ['-date_tournee', 'numero_tournee'],
                'unique_together': {('livreur', 'date_tournee')},
            },
        ),
        migrations.CreateModel(
            name='VenteTourneeMobile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('numero_vente', models.CharField(max_length=50, unique=True, verbose_name='N° Vente')),
                ('date_vente', models.DateTimeField(default=django.utils.timezone.now, verbose_name='Date vente')),
                ('montant_ht', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Montant HT')),
                ('montant_tva', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Montant TVA')),
                ('montant_total', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Montant total TTC')),
                ('type_paiement', models.CharField(choices=[('especes', 'Espèces'), ('carte', 'Carte'), ('cheque', 'Chèque'), ('credit', 'À crédit'), ('virement', 'Virement')], max_length=20, verbose_name='Type de paiement')),
                ('montant_paye', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Montant payé')),
                ('montant_rendu', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Monnaie rendue')),
                ('est_synchronise', models.BooleanField(default=False, verbose_name='Synchronisé')),
                ('date_synchronisation', models.DateTimeField(blank=True, null=True, verbose_name='Date synchronisation')),
                ('notes', models.TextField(blank=True, verbose_name='Notes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('arret', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ventes', to='API.arrettourneemobile')),
                ('client', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ventes_tournees', to='API.client')),
                ('tournee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ventes', to='API.tourneemobile')),
            ],
            options={
                'verbose_name': 'Vente tournée',
                'verbose_name_plural': 'Ventes tournées',
                'ordering': ['-date_vente'],
            },
        ),
        migrations.CreateModel(
            name='SyncLogMobile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('type_sync', models.CharField(choices=[('push', 'Push (Mobile -> Serveur)'), ('pull', 'Pull (Serveur -> Mobile)')], max_length=10, verbose_name='Type de sync')),
                ('statut', models.CharField(choices=[('en_cours', 'En cours'), ('succes', 'Succès'), ('echec', 'Échec'), ('partiel', 'Partiel')], max_length=20, verbose_name='Statut')),
                ('nb_tournees', models.PositiveIntegerField(default=0, verbose_name='Nb tournées')),
                ('nb_ventes', models.PositiveIntegerField(default=0, verbose_name='Nb ventes')),
                ('nb_arrets', models.PositiveIntegerField(default=0, verbose_name='Nb arrêts')),
                ('message', models.TextField(blank=True, verbose_name='Message')),
                ('erreur_details', models.TextField(blank=True, verbose_name='Détails erreur')),
                ('date_sync', models.DateTimeField(default=django.utils.timezone.now, verbose_name='Date synchronisation')),
                ('duree_secondes', models.PositiveIntegerField(blank=True, null=True, verbose_name='Durée (sec)')),
                ('device_id', models.CharField(blank=True, max_length=100, verbose_name='ID Device')),
                ('app_version', models.CharField(blank=True, max_length=20, verbose_name='Version app')),
                ('livreur', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sync_logs', to='API.livreurdistribution')),
            ],
            options={
                'verbose_name': 'Log de synchronisation',
                'verbose_name_plural': 'Logs de synchronisation',
                'ordering': ['-date_sync'],
            },
        ),
        migrations.CreateModel(
            name='RapportCaisseMobile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('fonds_depart', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Fonds de départ')),
                ('total_especes', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Total espèces')),
                ('total_cartes', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Total cartes')),
                ('total_cheques', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Total chèques')),
                ('total_credits', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Total à crédit')),
                ('total_encaissements', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Total encaissements')),
                ('carburant', models.DecimalField(decimal_places=2, default=0, max_digits=10, verbose_name='Carburant')),
                ('reparations', models.DecimalField(decimal_places=2, default=0, max_digits=10, verbose_name='Réparations')),
                ('autres_depenses', models.DecimalField(decimal_places=2, default=0, max_digits=10, verbose_name='Autres dépenses')),
                ('total_depenses', models.DecimalField(decimal_places=2, default=0, max_digits=10, verbose_name='Total dépenses')),
                ('solde_final_theorique', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Solde théorique')),
                ('solde_final_reel', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Solde réel')),
                ('ecart', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Écart')),
                ('justification_ecart', models.TextField(blank=True, verbose_name='Justification écart')),
                ('statut', models.CharField(choices=[('ouvert', 'Ouvert'), ('valide', 'Validé'), ('cloture', 'Clôturé')], default='ouvert', max_length=20, verbose_name='Statut')),
                ('date_validation', models.DateTimeField(blank=True, null=True, verbose_name='Date validation')),
                ('a_des_anomalies', models.BooleanField(default=False, verbose_name='Anomalies détectées')),
                ('notes_anomalies', models.TextField(blank=True, verbose_name='Notes anomalies')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('tournee', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='rapport_caisse', to='API.tourneemobile')),
                ('valide_par', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rapports_caisse_valides', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Rapport de caisse',
                'verbose_name_plural': 'Rapports de caisse',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='LigneVenteTourneeMobile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('quantite', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Quantité')),
                ('prix_unitaire', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Prix unitaire')),
                ('taux_tva', models.DecimalField(decimal_places=2, default=20, max_digits=5, verbose_name='Taux TVA (%)')),
                ('montant_ht', models.DecimalField(decimal_places=2, max_digits=12, verbose_name='Montant HT')),
                ('montant_tva', models.DecimalField(decimal_places=2, max_digits=12, verbose_name='Montant TVA')),
                ('montant_ttc', models.DecimalField(decimal_places=2, max_digits=12, verbose_name='Montant TTC')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('produit', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lignes_ventes_tournees', to='API.produit')),
                ('vente', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lignes', to='API.ventetourneemobile')),
            ],
            options={
                'verbose_name': 'Ligne vente tournée',
                'verbose_name_plural': 'Lignes ventes tournées',
            },
        ),
        migrations.CreateModel(
            name='DepenseTourneeMobile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('type_depense', models.CharField(choices=[('carburant', 'Carburant'), ('reparation', 'Réparation'), ('peage', 'Péage'), ('parking', 'Parking'), ('repas', 'Repas'), ('autre', 'Autre')], max_length=20, verbose_name='Type de dépense')),
                ('montant', models.DecimalField(decimal_places=2, max_digits=10, verbose_name='Montant')),
                ('description', models.CharField(max_length=200, verbose_name='Description')),
                ('photo_recu', models.ImageField(blank=True, null=True, upload_to='depenses/', verbose_name='Photo du reçu')),
                ('date_depense', models.DateTimeField(default=django.utils.timezone.now, verbose_name='Date dépense')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('rapport_caisse', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='depenses', to='API.rapportcaissemobile')),
            ],
            options={
                'verbose_name': 'Dépense tournée',
                'verbose_name_plural': 'Dépenses tournées',
                'ordering': ['-date_depense'],
            },
        ),
        migrations.AddField(
            model_name='arrettourneemobile',
            name='tournee',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='arrets', to='API.tourneemobile'),
        ),
        migrations.AlterUniqueTogether(
            name='arrettourneemobile',
            unique_together={('tournee', 'ordre_passage')},
        ),
    ]
