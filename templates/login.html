<!DOCTYPE html>
<html lang="fr">
<head>
  {% load static %}
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Market - Connexion</title>

  <!-- Fonts & Icons -->
  <link href="{% static 'style/font-face.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/font-awesome-5/css/fontawesome-all.min.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/mdi-font/css/material-design-iconic-font.min.css' %}" rel="stylesheet">

  <!-- Bootstrap -->
  <link href="{% static 'vendor/bootstrap-4.1/bootstrap.min.css' %}" rel="stylesheet">

  <!-- Animations/Vendors -->
  <link href="{% static 'vendor/animsition/animsition.min.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/wow/animate.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/css-hamburgers/hamburgers.min.css' %}" rel="stylesheet">

  <!-- Theme base -->
  <link href="{% static 'style/theme.css' %}" rel="stylesheet">

  <!-- Page-specific styles -->
  <style>
    :root {
      --bg-1: #0ea5ea;
      --bg-2: #2ea043;
      --muted: #64748b;      /* slate-500 */
      --text: #0f172a;        /* slate-900 */
      --text-2: #334155;      /* slate-700 */
      --border: rgba(2,6,23,.12);
      --accent: #16a34a;      /* green-600 */
      --accent-2: #60a5fa;    /* blue-400 */
    }

    body.login-page {
      min-height: 100vh;
      background: radial-gradient(1200px 800px at 10% 10%, rgba(255,255,255,.15), transparent 60%),
                  radial-gradient(1200px 800px at 90% 20%, rgba(255,255,255,.12), transparent 60%),
                  linear-gradient(135deg, var(--bg-1), var(--bg-2));
      display: flex; align-items: center; justify-content: center;
      position: relative; overflow: hidden;
    }

    .bg-bubble { position: absolute; border-radius: 50%; filter: blur(40px); opacity: .25; }
    .bg-bubble.b1 { width: 320px; height: 320px; background: #22c55e; top: -60px; left: -60px; animation: float1 12s ease-in-out infinite; }
    .bg-bubble.b2 { width: 240px; height: 240px; background: #60a5fa; bottom: 6vh; right: 6vw; animation: float2 14s ease-in-out infinite; }
    @keyframes float1 { 0%,100%{ transform: translate(0,0);} 50%{ transform: translate(25px, 20px);} }
    @keyframes float2 { 0%,100%{ transform: translate(0,0);} 50%{ transform: translate(-20px, -25px);} }

    /* Card clair et lisible */
    .login-card {
      width: 100%; max-width: 480px;
      border-radius: 20px;
      background: #ffffff;
      border: 1px solid var(--border);
      box-shadow: 0 24px 60px rgba(0,0,0,.18);
      overflow: hidden;
      color: var(--text);
    }

    .login-header {
      padding: 1.75rem 1.5rem 1rem;
      text-align: center;
      background: linear-gradient(to bottom, rgba(2,6,23,.04), transparent);
    }

    .brand-icon {
      width: 84px; height: 84px; border-radius: 18px; margin: 0 auto .85rem;
      display: grid; place-items: center;
      background: #f8fafc; /* slate-50 */
      border: 1px solid var(--border);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.6);
      overflow: hidden;
    }
    .brand-icon img { max-width: 100%; max-height: 100%; object-fit: cover; }

    .login-title { color: var(--text); margin-bottom: .25rem; }
    .login-subtitle { color: var(--muted); font-size: 1rem; }

    .login-body { padding: 1.25rem 1.5rem 1.5rem; }

    /* Champs plus grands et plus clairs */
    .form-label { font-weight: 600; color: var(--text); font-size: 1rem; }

    .input-group .input-group-text {
      background: #ffffff;
      color: var(--text-2);
      border-color: var(--border);
      font-size: 1.05rem;
      padding: .75rem .9rem;
      border-top-left-radius: .8rem;
      border-bottom-left-radius: .8rem;
    }

    .form-control {
      background: #ffffff;
      border-color: var(--border);
      color: var(--text);
      border-radius: .8rem;
      font-size: 1.05rem;
      padding: .9rem 1rem;
      height: auto;
      line-height: 1.4;
    }
    .form-control::placeholder { color: #94a3b8; }
    .form-control:focus {
      background: #ffffff;
      color: var(--text);
      border-color: var(--accent-2);
      box-shadow: 0 0 0 .2rem rgba(96,165,250,.25);
    }

    .custom-control-label { color: var(--text-2); font-size: .95rem; }

    .btn-login {
      border-radius: .9rem; padding: .95rem 1rem; font-weight: 700; letter-spacing: .2px;
      font-size: 1.05rem;
      background: linear-gradient(90deg, #22c55e, var(--accent));
      border: 0; box-shadow: 0 12px 22px rgba(34,197,94,.25);
    }
    .btn-login:hover { filter: brightness(1.03); transform: translateY(-1px); }
    .btn-login:active { transform: translateY(0); }

    .alert { border-radius: .9rem; }

    .login-footer { padding: .9rem 1.25rem 1.5rem; text-align: center; color: var(--muted); font-size: .95rem; }

    .opacity-80 { opacity: .8; }
  </style>
</head>
<body class="animsition login-page">
  <span class="bg-bubble b1"></span>
  <span class="bg-bubble b2"></span>

  <div class="login-card">
    <div class="login-header">
      <div class="brand-icon">
        <img src="{% static 'img/no-photo.png' %}" alt="Logo" />
      </div>
      <h1 class="h4 login-title mb-0">Gestion de Stock</h1>
      <p class="login-subtitle mb-0">Connectez-vous pour continuer</p>
    </div>

    <div class="login-body">
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-triangle mr-1"></i> {{ message }}
            <button type="button" class="close" data-dismiss="alert" aria-label="Fermer">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        {% endfor %}
      {% endif %}

      <form action="/" method="POST" id="checkLogin" novalidate>
        {% csrf_token %}

        <div class="form-group">
          <label for="email" class="form-label">Nom d'utilisateur</label>
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text"><i class="fas fa-user"></i></span>
            </div>
            <input class="form-control" type="text" id="email" name="username" placeholder="Entrez votre identifiant" autocomplete="username" required>
          </div>
        </div>

        <div class="form-group mb-2">
          <label for="password" class="form-label">Mot de passe</label>
          <div class="input-group" id="password_group">
            <div class="input-group-prepend">
              <span class="input-group-text"><i class="fas fa-lock"></i></span>
            </div>
            <input class="form-control" type="password" id="password" name="password" placeholder="Votre mot de passe" autocomplete="current-password" required>
            <div class="input-group-append">
              <span class="input-group-text" id="toggle_pwd" title="Afficher/Masquer" role="button" aria-label="Afficher ou masquer le mot de passe"><i class="far fa-eye"></i></span>
            </div>
          </div>
        </div>

        <div class="d-flex align-items-center justify-content-between mb-3">
          <div class="custom-control custom-checkbox">
            <input type="checkbox" class="custom-control-input" id="remember_me">
            <label class="custom-control-label" for="remember_me">Se souvenir de moi</label>
          </div>
          <!-- <a href="#" class="small">Mot de passe oublié ?</a> -->
        </div>

        <button id="connect" name="btn_submit" class="btn btn-success btn-block btn-login" type="submit">
          <i class="fas fa-sign-in-alt mr-1"></i> Connexion
        </button>
      </form>
    </div>

    <div class="login-footer">
      <small>© {{ now|default:None }} Market • Sécurité renforcée</small>
    </div>
  </div>

  <!-- Scripts -->
  <script src="{% static 'js/jquery-3.3.1.min.js' %}"></script>
  <script src="{% static 'vendor/bootstrap-4.1/popper.min.js' %}"></script>
  <script src="{% static 'vendor/bootstrap-4.1/bootstrap.min.js' %}"></script>
  <script>
    (function(){
      var toggler = document.getElementById('toggle_pwd');
      var input = document.getElementById('password');
      var form = document.getElementById('checkLogin');
      var btn = document.getElementById('connect');

      if (toggler && input){
        toggler.addEventListener('click', function(){
          var icon = this.querySelector('i');
          if (input.type === 'password'){
            input.type = 'text'; if(icon){ icon.classList.remove('fa-eye'); icon.classList.add('fa-eye-slash'); }
          } else {
            input.type = 'password'; if(icon){ icon.classList.remove('fa-eye-slash'); icon.classList.add('fa-eye'); }
          }
        });
      }

      if (form) {
        form.addEventListener('submit', function(){
          if (btn){
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>Connexion...';
          }
        });
      }
    })();
  </script>
</body>
</html>
