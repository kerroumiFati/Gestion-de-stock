{% load static %}
{% load i18n %}
<script src="{% static 'script/achat.js' %}" type="text/javascript"></script>
<div class="container-fluid">
    <div class="modal fade" id="error" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">{% trans "Erreur" %}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>{% trans "Impossible de supprimer ce Achat" %}</p>
                </div>
            </div>
        </div>
    </div>
    <div class="card bg-white">
        <div class="card-header card-color">
            <p class="h2 text-center text-uppercase font-weight-bold pt-2">{% trans "Gestion des Achats" %}</p>
        </div>
        <div class="mb-3">
  <ul class="nav nav-tabs" id="achatTabs">
    <li class="nav-item"><a class="nav-link active" href="#" data-target="#section-achat">{% trans "Achats" %}</a></li>
    <li class="nav-item"><a class="nav-link" href="#" data-target="#section-stock">{% trans "Stock par entrepôt" %}</a></li>
  </ul>
</div>
<form> {% csrf_token %}
            <div class="card-body container-fluid">
  <div id="section-achat">
                <div class="row">
                    <div class="col-sm-4 mb-2">
                        <label for="code">{% trans "Date d'Achat" %} : </label>
                        <input class="" type="text" id="id" hidden>
                         <input class="form-control" type="date"  id="datea">
                    </div>
                    <div class="col-sm-4 mb-2">
                        <label for="nom">{% trans "Quantité" %} : </label>
                        <input class="form-control" type="number" id="quantite" required>
                    </div>
                    <div class="col-sm-4 mb-2">
                        <label>{% trans "Prix d'achat unitaire" %}</label>
                        <input class="form-control" type="number" id="prix_achat" step="0.01" min="0" placeholder="0.00">
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4 mb-2">
                        <label for="dateexp">{% trans "Date d'expiration (optionnelle)" %} : </label>
                        <input class="form-control" type="date" id="dateexp" placeholder="{% trans 'Facultatif' %}">
                    </div>
                    <div class="col-sm-4 mb-2">
                        <label>{% trans "Total (auto)" %}</label>
                        <input class="form-control" type="text" id="total_achat" readonly placeholder="0.00">
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4 mb-2">
                        <label for="nom">{% trans "Fournisseur" %} : </label>
                        <select class="form-control" id="fournisseur">
                            <option class="twichiya">{% trans "Sélectionner un fournisseur" %}</option>
                        </select>
                    </div>
                    <div class="col-sm-4 mb-2">
                        <label for="warehouse">{% trans "Entrepôt" %} : </label>
                        <select class="form-control" id="warehouse">
                            <option class="twichiya">{% trans "Sélectionner un entrepôt" %}</option>
                        </select>
                    </div>
                    <div class="col-sm-4 mb-2">
                        <label for="ref">{% trans "Référence" %}: </label>
                        <input class="form-control" type="text" id="ref" placeholder="{% trans 'Tapez pour filtrer...' %}">
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6 mb-2">
                        <label for="codebar">{% trans "Code barre" %}: </label>
                        <input class="form-control" type="text" id="codebar" placeholder="{% trans 'Scannez / tapez...' %}">
                    </div>
                    <div class="col-sm-6 mb-2">
                        <label for="nom">{% trans "Produit" %}: </label>
                        <select class="form-control" id="sproduit">
                            <option class="opr">{% trans "Sélectionner un produit" %}</option>
                        </select>
                    </div>
                </div>

                <div class="row">
                    <div class="col">
                        <button type="button" class="btn btn-outline-success mt-3 mb-3" id="btn">{% trans "Ajouter" %}</button>
                    </div>
                </div>
              </div><!-- end section-achat -->
                <div id="section-stock" class="mt-4" style="display:none">
                  <h4>{% trans "Stocks par entrepôt" %}</h4>
                  <div class="form-row align-items-end mb-2">
                    <div class="form-group col-md-4">
                      <label>{% trans "Produit" %}</label>
                      <select id="ps_prod" class="form-control"><option value="">{% trans "Sélectionner un produit" %}</option></select>
                    </div>
                    <div class="form-group col-md-4">
                      <label>{% trans "Entrepôt" %}</label>
                      <select id="ps_wh" class="form-control"><option value="">{% trans "Tous les entrepôts" %}</option></select>
                    </div>
                    <div class="form-group col-md-4 text-right">
                      <button id="ps_refresh" type="button" class="btn btn-outline-primary">{% trans "Rafraîchir" %}</button>
                    </div>
                  </div>
                  <div class="row mb-2">
                    <div class="col">
                      <small id="ps_totals" class="text-muted"></small>
                    </div>
                  </div>
                  <div class="table-responsive">
                    <table id="tstock" class="table table-sm table-bordered">
                      <thead>
                        <tr><th>{% trans "Produit" %}</th><th>{% trans "Entrepôt" %}</th><th>{% trans "Quantité actuelle" %}</th><th>{% trans "Valeur" %}</th><th>{% trans "Nouvelle quantité" %}</th><th></th></tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>

                <div id="section-achat-table" class="row table-responsive m-auto rounded">
                    <table id="tachat" class="table table-hover w-100">
                        <thead>
                        <tr class="text-uppercase bg-light  w-100">
                            <th scope="col">{% trans "Id" %}</th>
                            <th scope="col">{% trans "Date d'Achat" %}</th>
                            <th scope="col">{% trans "Quantité" %}</th>
                            <th scope="col">{% trans "Fournisseur" %}</th>
                            <th scope="col">{% trans "Produit" %}</th>
                            <th scope="col">{% trans "Prix unitaire" %}</th>
                            <th scope="col">{% trans "Total" %}</th>
                            <th scope="col">{% trans "Supprimer" %}</th>
                            <th scope="col">{% trans "Modifier" %}</th>
                        </tr>
                        </thead>
                        <tbody id="table-content">

                        </tbody>
                    </table>
                </div>
            </div>
        </form>
    </div>
</div>
<script src="{% static 'script/produit_stocks.js' %}" type="text/javascript"></script>
<script type="text/javascript">
(function(){
  const tabs = document.querySelectorAll('#achatTabs .nav-link');
  function activate(target){
    document.querySelectorAll('#achatTabs .nav-link').forEach(a=>a.classList.remove('active'));
    tabs.forEach(a=>{ if(a.getAttribute('data-target')===target) a.classList.add('active'); });
    document.getElementById('section-achat').style.display = (target==='#section-achat') ? '' : 'none';
    var tachatWrap = document.getElementById('section-achat-table'); if(tachatWrap){ tachatWrap.style.display = (target==='#section-achat') ? '' : 'none'; }
    document.getElementById('section-stock').style.display = (target==='#section-stock') ? '' : 'none';
  }
  tabs.forEach(a=>a.addEventListener('click', function(e){ e.preventDefault(); activate(this.getAttribute('data-target')); }));
  // default to Achats
  activate('#section-achat');
})();

</script>